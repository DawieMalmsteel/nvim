Panic in agent.Run: runtime error: invalid memory address or nil pointer dereference

Time: 2025-09-24T00:13:46+07:00

Stack Trace:
goroutine 1183 [running]:
runtime/debug.Stack()
	/opt/hostedtoolcache/go/1.25.1/x64/src/runtime/debug/stack.go:26 +0x5e
github.com/charmbracelet/crush/internal/log.RecoverPanic({0x1d59f5f, 0x9}, 0xc003437f58)
	/home/runner/work/crush/crush/internal/log/log.go:62 +0x238
panic({0x19f0940?, 0x3437ec0?})
	/opt/hostedtoolcache/go/1.25.1/x64/src/runtime/panic.go:783 +0x132
internal/stringslite.HasPrefix(...)
	/opt/hostedtoolcache/go/1.25.1/x64/src/internal/stringslite/strings.go:17
internal/stringslite.TrimPrefix(...)
	/opt/hostedtoolcache/go/1.25.1/x64/src/internal/stringslite/strings.go:130
strings.TrimPrefix(...)
	/opt/hostedtoolcache/go/1.25.1/x64/src/strings/strings.go:1130
github.com/charmbracelet/crush/internal/llm/tools.createFileTree({0xc0002e1208, 0x88, 0x0?}, {0xc0000440a4, 0x18})
	/home/runner/work/crush/crush/internal/llm/tools/ls.go:215 +0x153
github.com/charmbracelet/crush/internal/llm/tools.ListDirectoryTree({0xc0000440a4, 0x18}, {0x0, 0x0, 0x0})
	/home/runner/work/crush/crush/internal/llm/tools/ls.go:200 +0x105
github.com/charmbracelet/crush/internal/llm/prompt.getEnvironmentInfo()
	/home/runner/work/crush/crush/internal/llm/prompt/coder.go:59 +0x76
github.com/charmbracelet/crush/internal/llm/prompt.TaskPrompt()
	/home/runner/work/crush/crush/internal/llm/prompt/task.go:14 +0x13
github.com/charmbracelet/crush/internal/llm/prompt.GetPrompt({0x1d4c68c?, 0xc0003b4eb0?}, {0xc0003b5496?, 0xc0003b4ea0?}, {0x345f780?, 0x0?, 0xc000c54b70?})
	/home/runner/work/crush/crush/internal/llm/prompt/prompt.go:33 +0x38
github.com/charmbracelet/crush/internal/llm/agent.NewAgent({0x2429758, 0xc00043c1c0}, {{0x1d4c68c, 0x4}, {0x1d4c690, 0x4}, {0x1dc35ed, 0x52}, 0x0, {0x1d4e687, ...}, ...}, ...)
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:137 +0x3e9
github.com/charmbracelet/crush/internal/llm/agent.NewAgent.func1()
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:113 +0x1a5
github.com/charmbracelet/crush/internal/llm/agent.(*agent).getAllTools(0xc000682420)
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:510 +0x131
github.com/charmbracelet/crush/internal/llm/agent.(*agent).streamAndHandleEvents(0xc000682420, {0x2429028, 0xc000440690}, {0xc00028bc20, 0x24}, {0xc000317008, 0x12, 0x22})
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:577 +0xe7a
github.com/charmbracelet/crush/internal/llm/agent.(*agent).processGeneration(0xc000682420, {0x2429028, 0xc000440690}, {_, _}, {_, _}, {0x0, 0x0, 0x0})
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:438 +0x858
github.com/charmbracelet/crush/internal/llm/agent.(*agent).Run.func1()
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:373 +0x454
created by github.com/charmbracelet/crush/internal/llm/agent.(*agent).Run in goroutine 1
	/home/runner/work/crush/crush/internal/llm/agent/agent.go:364 +0x393

