set-option -g default-shell /usr/bin/fish
set -g default-terminal "xterm-256color"
set -as terminal-overrides ",tmux-256color:Tc"
set -g @tmux-256color 'true'
set -g history-limit 30000
set -g mouse on
set -g base-index 1
set -g pane-base-index 1
set -g allow-rename off
set -g renumber-windows on
set -g focus-events on
set -g aggressive-resize on
set -g status-interval 1
# set -g utf8 on
# set -g status-utf8 on

# Thiết lập prefix key
set -g prefix C-b
unbind C-a
bind C-b send-prefix

# --- Phím tắt (Keymaps) ---

# 1. Quản lý pane
bind -n M-- split-window -v -c "#{pane_current_path}"  # Alt+-: Chia pane dưới
bind -n M-\\ split-window -h -c "#{pane_current_path}" # Alt+\: Chia pane bên phải
bind -n M-_ split-window -v -b -c "#{pane_current_path}"  # Alt+_: Chia pane trên
bind -n M-| split-window -h -b -c "#{pane_current_path}"  # Alt+|: Chia pane bên trái
bind x kill-pane                                       # Ctrl-b x: Đóng pane
# bind -n M-w kill-pane                                  # Alt+w: Đóng pane
bind -n M-DC confirm-before -p "Kill pane? (y/n)" kill-pane  # Alt+Delete: Xóa pane với xác nhận
bind -n M-Bspace kill-pane                             # Alt+Backspace: Xóa pane ngay
bind & kill-window                                     # Ctrl-b &: Đóng window

# 2. Điều hướng pane
bind h select-pane -L  # Ctrl-b h: Sang pane trái
bind j select-pane -D  # Ctrl-b j: Xuống pane dưới
bind k select-pane -U  # Ctrl-b k: Lên pane trên
bind l select-pane -R  # Ctrl-b l: Sang pane phải
bind -n M-h if-shell -F "#{window_zoomed_flag}" "select-pane -L \; resize-pane -Z" "select-pane -L"  # Alt+h: Stay zoomed
bind -n M-j if-shell -F "#{window_zoomed_flag}" "select-pane -D \; resize-pane -Z" "select-pane -D"  # Alt+j: Stay zoomed
bind -n M-k if-shell -F "#{window_zoomed_flag}" "select-pane -U \; resize-pane -Z" "select-pane -U"  # Alt+k: Stay zoomed
bind -n M-l if-shell -F "#{window_zoomed_flag}" "select-pane -R \; resize-pane -Z" "select-pane -R"  # Alt+l: Stay zoomed


# 3. Thay đổi kích thước pane
bind -r H resize-pane -L 2  # Ctrl-b H: Thu nhỏ pane trái
bind -r J resize-pane -D 2  # Ctrl-b J: Thu nhỏ pane dưới
bind -r K resize-pane -U 2  # Ctrl-b K: Thu nhỏ pane trên
bind -r L resize-pane -R 2  # Ctrl-b L: Thu nhỏ pane phải
bind -n M-H resize-pane -L 2  # Alt+H: Thu nhỏ trái
bind -n M-J resize-pane -D 2  # Alt+J: Thu nhỏ dưới
bind -n M-K resize-pane -U 2  # Alt+K: Thu nhỏ trên
bind -n M-L resize-pane -R 2  # Alt+L: Thu nhỏ phải

# 4. Quản lý window
bind c new-window -c "#{pane_current_path}"  # Ctrl-b c: Tạo window mới
bind w kill-window                           # Ctrl-b w: Đóng window
bind -n M-t new-window -c "#{pane_current_path}"  # Alt+t: Tạo window
bind -n M-W kill-window                    # Alt+Shift+w: Đóng window
bind -n M-Left previous-window             # Alt+Left: Window trước
bind -n M-Right next-window                # Alt+Right: Window sau
bind n next-window                         # Ctrl-b n: Window sau
bind p previous-window                     # Ctrl-b p: Window trước
bind , command-prompt -I "#W" "rename-window '%%'"  # Ctrl-b ,: Đổi tên window
bind -n M-, previous-window                # Alt+[: Window trước
bind -n M-. next-window                    # Alt+]: Window sau
bind -n M-p previous-window                # Alt+[: Window trước
bind -n M-n next-window                    # Alt+]: Window sau
bind -n M-~ choose-window                  # Alt+`: Mở bảng chọn window
bind -n M-` choose-session                 # Alt+~: Mở bảng chọn session

# 5. Quản lý session
bind s new-session                         # Ctrl-b s: Tạo session mới
bind S choose-session                      # Ctrl-b S: Chọn session
bind $ command-prompt -I "#S" "rename-session '%%'"  # Ctrl-b $: Đổi tên session
bind Q confirm-before -p "Kill session #S?" kill-session  # Ctrl-b Q: Thoát session
bind -n M-S new-session                    # Alt+s: Tạo session
# bind -n M-S choose-session                 # Alt+Shift+s: Chọn session
bind -n M-Q confirm-before -p "Kill session #S?" kill-session  # Alt+Shift+q: Xóa session hiện tại

# 6. Copy/paste (chế độ copy mode, kiểu vim)
set -g mode-keys vi
bind [ copy-mode                           # Ctrl-b [: Vào copy mode
bind -n M-c copy-mode                      # Alt+c: Vào copy mode
bind -T copy-mode-vi v send-keys -X begin-selection  # v: Bắt đầu chọn
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel  # y: Sao chép và thoát
bind ] paste-buffer                        # Ctrl-b ]: Dán
bind -n M-v paste-buffer                   # Alt+v: Dán

# 7. Tùy chỉnh tmux
bind r source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf"  # Ctrl-b r: Reload cấu hình
# bind -n M-r source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf"  # Alt+r: Reload
bind b set-option -g status                # Ctrl-b b: Bật/tắt status bar
bind -n M-b set-option -g status           # Alt+b: Bật/tắt status bar
bind z resize-pane -Z                      # Ctrl-b z: Phóng to/thu nhỏ pane
bind -n M-z resize-pane -Z                 # Alt+z: Phóng to/thu nhỏ pane
bind t display-panes                       # Ctrl-b t: Hiển thị số pane
bind -n M-T display-panes                  # Alt+Shift+t: Hiển thị số pane

# 8. Chuyển layout pane
bind o select-layout tiled                 # Ctrl-b o: Layout tiled
bind e select-layout even-horizontal       # Ctrl-b e: Layout ngang đều
bind u select-layout even-vertical         # Ctrl-b u: Layout dọc đều
# bind -n M-o select-layout tiled            # Alt+o: Layout tiled
bind -n M-e select-layout even-horizontal  # Alt+e: Layout ngang
bind -n M-u select-layout even-vertical    # Alt+u: Layout dọc

# 9.  Di chuyển window

#this code make error when use yazi
# bind -n M-P swap-window -t -1 \; select-window -p  # Alt+<: Di chuyển window về trước
# bind -n M-N swap-window -t +1 \; select-window -n  # Alt+>: Di chuyển window về sau

bind -n M-< swap-window -t -1 \; select-window -p  # Alt+<: Di chuyển window về trước
bind -n M-> swap-window -t +1 \; select-window -n  # Alt+>: Di chuyển window về sau

# 10. Sync pane
bind y set-window-option synchronize-panes  # Ctrl-b y: Bật/tắt sync pane
bind -n M-y set-window-option synchronize-panes  # Alt+y: Bật/tắt sync pane

# --- Minimalist Tmux Status Bar (Catppuccin Mocha, Centered Tabs, Right Static Content) 10--
set -g status on
set -g status-position bottom
# set -g status-style "bg=#1e1e2e,fg=#cdd6f4"  # Nền tím đậm, chữ sáng
# Catppuccin official plugin configuration (remove manual color overrides)
set -g @catppuccin_flavor "mocha"                 # latte | frappe | macchiato | mocha
set -g @catppuccin_window_status_style "rounded"  # default | slanted | rounded | bordered

# Status lengths
set -g status-left-length 60
set -g status-right-length 50

# Let Catppuccin handle colours/styles for windows
set -g status-left '#{?window_zoomed_flag,#[bg=#1e1e2e]#[fg=#a6e3a1] 󰌪 #[default],#{?#{==:#{window_panes},1},#[bg=#1e1e2e]#[fg=#89b4fa] 󰂔 #[default],#[bg=#1e1e2e]#[fg=#cdd6f4] 󰇘 #[default]}} '

# Use Catppuccin provided segments (application, cpu, session, uptime, battery)
set -g status-right "#{pomodoro_status} #{E:@catppuccin_status_application}"
set -ag  status-right "#{E:@catppuccin_status_session}"
set -ag  status-right "#{E:@catppuccin_status_uptime}"
set -agF status-right "#{E:@catppuccin_status_battery}"


# Keep separator only (do not unset formats here; Catppuccin will set them first)
set -g window-status-separator " "
# Thông báo và chế độ
set -g message-style "bg=#a6e3a1,fg=#1e1e2e"
set -g mode-style "bg=#cba6f7,fg=#1e1e2e"

# --- Plugin ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'catppuccin/tmux#v2.1.3'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @plugin 'olimorris/tmux-pomodoro-plus'

# Cấu hình plugin
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session' # Hỗ trợ lưu/restore neovim
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'  # Lưu mỗi 15 phút
set -g @yank_selection 'clipboard'
set -g @pomodoro_sound 'on'      
set -g @pomodoro_notifications 'on'

#fix tmux
set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM


# command to fix tmux: tmux kill-server && tmux || tmux

# Khởi tạo TPM
run '~/.tmux/plugins/tpm/tpm'

set -g status-style 'bg=default,fg=default'
set -g window-style 'bg=default'
set -g window-active-style 'bg=default'

